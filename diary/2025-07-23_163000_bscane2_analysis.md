# BSCANE2 Connection Analysis and Documentation Update

## Date: 2025-07-23 16:30:00

### Purpose
ユーザーからのBSCANE2接続についての質問に回答し、READMEに詳細な説明を追加

### Technical Analysis Performed

#### 1. BSCANE2外部通信メカニズムの説明

**自動接続の仕組み:**
```text
外部JTAGケーブル → FPGA JTAGピン → 内蔵JTAGコントローラ → BSCANE2 → ユーザーロジック
```

- BSCANE2は外部ピン配線が不要
- FPGA内蔵のJTAGコントローラに自動接続
- 標準JTAGコネクタ（TDI, TDO, TCK, TMS）経由でアクセス

#### 2. 現在の接続状況の検証

**✅ 適切な接続:**
- DRCK → jtag_tck (データレジスタクロック)
- SEL → jtag_sel (USER1命令選択)
- SHIFT → jtag_shift (シフト状態)
- TDI → jtag_tdi (データ入力)
- TDO ← jtag_tdo (データ出力)
- CAPTURE → jtag_capture (キャプチャ状態)
- UPDATE → jtag_update (アップデート状態)
- RESET → jtag_reset (リセット信号)

**✅ 正常な未接続:**
- TCK (DRCKを使用するため未使用)
- TMS (データレジスタでは不要)
- RUNTEST (この設計では未使用)

#### 3. 外部アクセス方法の確認

- **Vivado Hardware Manager**: create_hw_axi_txn使用
- **OpenOCD**: irscan/drscanコマンド使用
- **SVF**: SIR/SDRコマンド使用
- **カスタムツール**: 96ビットシフト操作サポート

### Documentation Updates

#### READMEへの追加内容

1. **BSCANE2 Connection and Communication**セクション追加
   - 外部通信メカニズムの詳細説明
   - 自動接続の仕組み
   - USER1命令選択プロセス

2. **Signal Connections Analysis**
   - 適切に接続された信号の説明
   - 正常に未接続の信号とその理由
   - SystemVerilogコード例

3. **External Access Methods**
   - 各種JTAGツールでのアクセス方法
   - 互換性のあるツール一覧

### Key Technical Insights

#### BSCANE2の設計利点
- **簡単な実装**: 外部ピン制約不要
- **標準準拠**: IEEE 1149.1 JTAG標準
- **ツール互換性**: 幅広いJTAGツールサポート
- **セキュリティ**: USER命令による分離

#### 接続確認手順
1. Vivadoでhw_axis認識確認
2. シンプルな読み書きテスト実行
3. LEDパターンでの動作確認

### Validation Results

- ✅ BSCANE2接続は適切に実装済み
- ✅ 外部通信経路は正常に設計済み
- ✅ 複数のアクセス方法に対応済み
- ✅ ドキュメントに詳細説明を追加完了

### Next Steps

1. ユーザーによる実際のハードウェアテスト
2. 各種JTAGツールでの動作確認
3. 必要に応じてトラブルシューティングガイド追加

### Implementation Status

- ✅ **COMPLETED** - BSCANE2接続分析とドキュメント更新
- 🔍 **READY FOR TESTING** - ハードウェア実機での動作確認準備完了
- 📖 **DOCUMENTED** - README.mdに詳細な技術説明を追加

## 技術的知見の共有

### BSCANE2使用時のベストプラクティス

1. **クロックドメイン**: DRCKとシステムクロック間の適切な同期化
2. **リセット処理**: jtag_resetとシステムリセットの独立性確保
3. **状態管理**: CAPTURE/SHIFT/UPDATE状態の適切な処理
4. **データ整合性**: 96ビットシフトレジスタの正確な実装

### デバッグのポイント

1. **接続確認**: hw_axisがVivadoで認識されるか
2. **命令選択**: USER1命令（0x02）が正しく選択されるか
3. **データフロー**: TDI→シフトレジスタ→AXI→TDO経路の確認
4. **タイミング**: クロックドメイン間の同期確認

この分析により、BSCANE2の接続と外部通信の仕組みが明確化され、ユーザーが安心してシステムを使用できるようになった。
